<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="CatBug">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <title>CatBug - Katzenspiel</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    html, body {
      height: 100%;
      overflow: hidden;
      background: #000;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }

    /* --- Game screen --- */
    #game {
      position: fixed;
      inset: 0;
      background: #000;
      cursor: none;
    }

    #bug {
      position: absolute;
      transition: none;
      pointer-events: none;
    }

    /* Bug SVG body parts */
    .bug-body { fill: #4a3728; }
    .bug-head { fill: #3a2a1c; }
    .bug-legs { stroke: #3a2a1c; stroke-width: 1.5; fill: none; stroke-linecap: round; }
    .bug-antenna { stroke: #3a2a1c; stroke-width: 1; fill: none; stroke-linecap: round; }
    .bug-eye { fill: #111; }
    .bug-shell-line { stroke: #3a2a1c; stroke-width: 0.8; fill: none; }
    .bug-shine { fill: rgba(255,255,255,0.08); }

    /* Leg animation */
    @keyframes legWiggle1 {
      0%, 100% { transform: rotate(-8deg); }
      50% { transform: rotate(8deg); }
    }
    @keyframes legWiggle2 {
      0%, 100% { transform: rotate(8deg); }
      50% { transform: rotate(-8deg); }
    }
    .leg-group-1 { animation: legWiggle1 0.2s infinite; }
    .leg-group-2 { animation: legWiggle2 0.2s infinite; }

    .legs-paused .leg-group-1,
    .legs-paused .leg-group-2 {
      animation-play-state: paused;
    }

    /* --- Settings button --- */
    #settingsBtn {
      position: fixed;
      top: max(12px, env(safe-area-inset-top));
      right: max(12px, env(safe-area-inset-right));
      width: 36px;
      height: 36px;
      background: none;
      border: none;
      color: #333;
      cursor: pointer;
      z-index: 50;
      padding: 4px;
      transition: color 0.2s;
    }
    #settingsBtn:active { color: #666; }
    #settingsBtn svg { width: 100%; height: 100%; }

    /* --- Settings overlay --- */
    #settings {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
    }
    #settings.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .settings-card {
      width: 85%;
      max-width: 340px;
      background: #111;
      border-radius: 20px;
      padding: 32px 24px;
    }

    .settings-title {
      color: #fff;
      font-size: 20px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 32px;
    }

    .setting-group {
      margin-bottom: 28px;
    }

    .setting-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #aaa;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .setting-value {
      color: #fff;
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }

    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: #333;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #fff;
      cursor: pointer;
    }

    .close-btn {
      display: block;
      width: 100%;
      padding: 16px;
      margin-top: 8px;
      background: #222;
      border: none;
      border-radius: 14px;
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
    }
    .close-btn:active { background: #333; }
  </style>
</head>
<body>

  <!-- Game area -->
  <div id="game">
    <div id="bug">
      <svg viewBox="0 0 40 50" xmlns="http://www.w3.org/2000/svg">
        <!-- Antennae -->
        <path class="bug-antenna" d="M16 14 Q12 4 8 2"/>
        <path class="bug-antenna" d="M24 14 Q28 4 32 2"/>
        <!-- Legs left (group 1: front+back, group 2: middle) -->
        <g class="leg-group-1" style="transform-origin: 14px 28px">
          <path class="bug-legs" d="M14 22 Q6 18 3 15"/>
          <path class="bug-legs" d="M14 36 Q6 40 3 43"/>
        </g>
        <g class="leg-group-2" style="transform-origin: 14px 28px">
          <path class="bug-legs" d="M14 28 Q5 28 2 26"/>
        </g>
        <!-- Legs right (group 2: front+back, group 1: middle) -->
        <g class="leg-group-2" style="transform-origin: 26px 28px">
          <path class="bug-legs" d="M26 22 Q34 18 37 15"/>
          <path class="bug-legs" d="M26 36 Q34 40 37 43"/>
        </g>
        <g class="leg-group-1" style="transform-origin: 26px 28px">
          <path class="bug-legs" d="M26 28 Q35 28 38 26"/>
        </g>
        <!-- Body -->
        <ellipse class="bug-body" cx="20" cy="30" rx="9" ry="12"/>
        <!-- Shell line -->
        <line class="bug-shell-line" x1="20" y1="19" x2="20" y2="42"/>
        <!-- Shine -->
        <ellipse class="bug-shine" cx="17" cy="26" rx="3" ry="5" transform="rotate(-15 17 26)"/>
        <!-- Head -->
        <circle class="bug-head" cx="20" cy="16" r="6"/>
        <!-- Eyes -->
        <circle class="bug-eye" cx="18" cy="15" r="1.2"/>
        <circle class="bug-eye" cx="22" cy="15" r="1.2"/>
      </svg>
    </div>
  </div>

  <!-- Settings button -->
  <button id="settingsBtn" aria-label="Einstellungen">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="3"/>
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
    </svg>
  </button>

  <!-- Settings overlay -->
  <div id="settings">
    <div class="settings-card">
      <div class="settings-title">Einstellungen</div>

      <div class="setting-group">
        <div class="setting-label">
          <span>Geschwindigkeit</span>
          <span class="setting-value" id="speedValue">50%</span>
        </div>
        <input type="range" id="speedSlider" min="10" max="100" value="50">
      </div>

      <div class="setting-group">
        <div class="setting-label">
          <span>Gr&ouml;&szlig;e</span>
          <span class="setting-value" id="sizeValue">50%</span>
        </div>
        <input type="range" id="sizeSlider" min="20" max="100" value="50">
      </div>

      <button class="close-btn" id="closeSettings">Fertig</button>
    </div>
  </div>

  <script>
    // --- Settings ---
    const SETTINGS_KEY = 'catbug_settings';
    const defaults = { speed: 50, size: 50 };
    let settings = Object.assign({}, defaults, JSON.parse(localStorage.getItem(SETTINGS_KEY) || '{}'));

    const speedSlider = document.getElementById('speedSlider');
    const sizeSlider = document.getElementById('sizeSlider');
    const speedValue = document.getElementById('speedValue');
    const sizeValue = document.getElementById('sizeValue');
    const settingsEl = document.getElementById('settings');

    function applySettings() {
      speedSlider.value = settings.speed;
      sizeSlider.value = settings.size;
      speedValue.textContent = settings.speed + '%';
      sizeValue.textContent = settings.size + '%';
      updateBugSize();
      localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
    }

    speedSlider.addEventListener('input', () => {
      settings.speed = parseInt(speedSlider.value);
      applySettings();
    });

    sizeSlider.addEventListener('input', () => {
      settings.size = parseInt(sizeSlider.value);
      applySettings();
    });

    document.getElementById('settingsBtn').addEventListener('click', (e) => {
      e.stopPropagation();
      settingsEl.classList.add('visible');
    });

    document.getElementById('closeSettings').addEventListener('click', () => {
      settingsEl.classList.remove('visible');
    });

    // --- Bug movement ---
    const bugEl = document.getElementById('bug');
    const bugSvg = bugEl.querySelector('svg');
    let bugX, bugY, angle, targetX, targetY;
    let paused = false;
    let pauseTimer = 0;
    let animFrame;

    function updateBugSize() {
      const s = 30 + (settings.size / 100) * 70; // 30px to 100px
      bugEl.style.width = s + 'px';
      bugEl.style.height = (s * 1.25) + 'px';
    }

    function getSpeed() {
      return 0.5 + (settings.speed / 100) * 3.5; // 0.5 to 4 px per frame
    }

    function pickTarget() {
      const W = window.innerWidth;
      const H = window.innerHeight;
      const overflow = 60; // allow crawling partially off-screen
      targetX = -overflow + Math.random() * (W + overflow * 2);
      targetY = -overflow + Math.random() * (H + overflow * 2);
    }

    function init() {
      bugX = window.innerWidth / 2;
      bugY = window.innerHeight / 2;
      angle = Math.random() * Math.PI * 2;
      pickTarget();
      applySettings();
      loop();
    }

    function loop() {
      if (!settingsEl.classList.contains('visible')) {
        if (paused) {
          pauseTimer--;
          if (pauseTimer <= 0) {
            paused = false;
            bugSvg.classList.remove('legs-paused');
            pickTarget();
          }
        } else {
          const dx = targetX - bugX;
          const dy = targetY - bugY;
          const dist = Math.sqrt(dx * dx + dy * dy);

          if (dist < 5) {
            // Reached target â€” maybe pause briefly
            if (Math.random() < 0.4) {
              paused = true;
              pauseTimer = 30 + Math.random() * 90; // 0.5s to 2s pause
              bugSvg.classList.add('legs-paused');
            } else {
              pickTarget();
            }
          } else {
            const targetAngle = Math.atan2(dy, dx);
            // Smoothly turn toward target
            let angleDiff = targetAngle - angle;
            while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
            while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;
            angle += angleDiff * 0.08;

            const speed = getSpeed();
            bugX += Math.cos(angle) * speed;
            bugY += Math.sin(angle) * speed;
          }
        }

        // Update position and rotation (offset by half size for centering)
        const s = bugEl.offsetWidth;
        const h = bugEl.offsetHeight;
        const rotation = (angle * 180 / Math.PI) + 90; // +90 because SVG bug points up
        bugEl.style.transform = `translate(${bugX - s/2}px, ${bugY - h/2}px) rotate(${rotation}deg)`;
      }

      animFrame = requestAnimationFrame(loop);
    }

    init();

    // --- Keep screen on via silent video loop ---
    let noSleepVideo = null;

    function createVideo() {
      const mp4 = 'AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAA'
        + 'OBtZGF0AAACrgYF//+q3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlID'
        + 'E0OCByMjY0MyA1YzY1NzA0IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyA'
        + 'tIENvcHlsZWZ0IDIwMDMtMjAxNSAtIGh0dHA6Ly93d3cudmlkZW9sYW4u'
        + 'b3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVib'
        + 'G9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9Ny'
        + 'Bwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3Jhbmd'
        + 'lPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBk'
        + 'ZWFkem9uZT0yMSwyMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNld'
        + 'D0tMiB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdG'
        + 'hyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF'
        + '5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJf'
        + 'cHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlna'
        + 'HRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbn'
        + 'RfbWluPTEwIHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29'
        + 'rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAu'
        + 'NjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwI'
        + 'GFxPTE6MS4wMAAAAAADaWllYXMAAAAA/2QBZN/hAAAAC3Rya24AAABcZWR0'
        + 'cwAAABRlbHN0AAAAAAAAAAEAAAAAAAAAFHNraXAAAAAIZnJlZQAAAAhtZGF0'
        + 'AAAAMm1vb3YAAABsbXZoZAAAAAAAAAAAAAAAAAAAA+gAAAAAAAEAAAAAAQA'
        + 'AAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAA'
        + 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAmHRyYWsAAABcdGt'
        + 'oZAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAA'
        + 'AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAABAAAAAAAAAAAAADAAFN'
        + 'AAAB0bWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAADIAAAACAFXEAAAAAAAtaGR'
        + 'scgAAAAAAAAAAc291bgAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx'
        + '1cmwgAAAAAQAAAChzdGJsAAAAGHN0c2QAAAAAAAAAAQAAAA8AAAAAAAAAAA'
        + 'AUc3RzegAAAAAAAAAAAAAUc3RjbwAAAAAAAAAA';

      const bin = atob(mp4);
      const bytes = new Uint8Array(bin.length);
      for (let i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);

      const v = document.createElement('video');
      v.setAttribute('playsinline', '');
      v.setAttribute('muted', '');
      v.setAttribute('loop', '');
      v.muted = true;
      v.style.cssText = 'position:fixed;top:-1px;left:-1px;width:1px;height:1px;opacity:0.01';
      v.src = URL.createObjectURL(new Blob([bytes], { type: 'video/mp4' }));
      return v;
    }

    function startVideo() {
      if (!noSleepVideo) {
        noSleepVideo = createVideo();
        document.body.appendChild(noSleepVideo);
      }
      noSleepVideo.play().catch(() => {});
    }

    startVideo();
    document.addEventListener('click', () => {
      if (noSleepVideo && noSleepVideo.paused) startVideo();
    });
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') startVideo();
    });

    // Prevent double-tap zoom on iOS
    let lastTouchEnd = 0;
    document.addEventListener('touchend', (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) e.preventDefault();
      lastTouchEnd = now;
    }, false);
  </script>
</body>
</html>
